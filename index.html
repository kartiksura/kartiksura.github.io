<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9H97RK50TD"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-9H97RK50TD');
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Find popular places around you</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.2/css/bootstrap.min.css" />

  <style>
    :root{
      --accent:#00b4cc;
      --accent-soft:#66e0ef;
      --bg:#000;
      --text:#fff;
      --muted:#ddd;
    }
    html,body{ height:100%; }
    body{
      background:var(--bg);
      color:var(--text);
      font-family:"Open Sans",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      -webkit-text-size-adjust:100%;
    }

    .app{ padding-top:12px; padding-bottom:16px; }
    h1.text-warning{ font-size:clamp(1.25rem,2.8vw,1.8rem); }
    h4.text-secondary{ font-size:clamp(0.95rem,2.2vw,1.1rem); }

    .statusbar{
      position:sticky; top:0; z-index:10;
      background:#111; color:#7ff; padding:6px 10px; font-size:12px;
      border-bottom:1px solid #0aa; display:none;
    }
    .statusbar.show{ display:block; }

    .searchTerm{
      border:3px solid var(--accent);
      padding:8px 12px; height:56px; outline:none; font-size:18px; border-radius:5px;
    }
    .input-group .searchTerm{ width:auto; flex:1 1 auto; border-top-right-radius:0; border-bottom-right-radius:0; }
    #go-btn{
      height:56px; font-weight:600; white-space:nowrap;
      border-top-left-radius:0; border-bottom-left-radius:0; border:3px solid var(--accent); border-left:0;
    }

    .sticky-controls{
      position:sticky; top:0; z-index:3;
      background:linear-gradient(180deg, rgba(0,0,0,0.92), rgba(0,0,0,0.92));
      padding-top:6px; padding-bottom:8px;
    }

    .hint{ font-size:12px; opacity:0.8; }
    .notice{ font-size:12px; color:var(--muted); margin:6px 0 0; }
    .btn-toggle .btn{ cursor:pointer; margin-right:6px; margin-top:6px; }

    #map{ height:clamp(220px, 42vh, 420px); border-radius:8px; }
    .list-group{ font-size:16px; color:#000; }
    .list-group-item strong{ font-size:16px; }
    .image-parent{ max-width:180px; }
    .image-parent img{ border-radius:6px; }

    /* Slider (fat & touch-friendly) */
    #distance-slider{
      -webkit-appearance:none; width:100%; height:18px; background:transparent; margin:6px 0;
      cursor:pointer; touch-action:pan-y;
    }
    #distance-slider:focus{ outline:none; }
    #distance-slider::-webkit-slider-runnable-track{
      height:18px; background:#1b1b1b; border-radius:10px; border:1px solid var(--accent);
    }
    #distance-slider::-webkit-slider-thumb{
      -webkit-appearance:none; margin-top:-6px; width:30px; height:30px; border-radius:50%;
      background:var(--accent); border:2px solid var(--accent-soft); box-shadow:0 0 0 3px rgba(0,180,204,0.15);
    }
    #distance-slider:active::-webkit-slider-thumb{ transform:scale(1.05); }

    /* InfoWindow readable on white */
    .iw{ color:#111; }
    .iw .meta{ color:#333; }
    .iw a{ color:#0d6efd; text-decoration:none; }
    .iw a:hover{ text-decoration:underline; }
    .gm-style .gm-style-iw-c, .gm-style .gm-style-iw-d{ color:#111; }

    /* Phones */
    @media (max-width:576px){
      .app{ padding-left:10px; padding-right:10px; }
      .list-group-item{ padding:10px 12px; }
      .list-group-item strong{ display:block; margin-bottom:2px; }
      .image-parent{ max-width:120px; }
      #go-btn{ height:56px; padding-left:14px; padding-right:14px; }
      .btn-toggle .btn{ font-size:14px; padding:6px 10px; }
      #map{ height:clamp(220px, 48vh, 420px); }
    }
  </style>

  <script>
    // suppress noisy extension error
    window.addEventListener('unhandledrejection', (e) => {
      const msg = String((e && e.reason && e.reason.message) || e.reason || '');
      if (msg.includes('A listener indicated an asynchronous response')) e.preventDefault();
    });

    function setStatus(msg){
      const el = document.getElementById('statusbar');
      if (!el) return;
      el.textContent = msg;
      el.classList.add('show');
      console.log('[status]', msg);
    }

    function haversineKm(a,b){ const toRad=d=>d*Math.PI/180;
      const lat1=a.lat(),lon1=a.lng(),lat2=b.lat(),lon2=b.lng(),R=6371;
      const dLat=toRad(lat2-lat1), dLon=toRad(lon2-lon1);
      const s1=Math.sin(dLat/2)**2, s2=Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
      return 2*R*Math.asin(Math.sqrt(s1+s2)); }
    function distanceMeters(origin, loc){
      if (window.google?.maps?.geometry?.spherical) return google.maps.geometry.spherical.computeDistanceBetween(origin, loc);
      return haversineKm(origin, loc)*1000;
    }
    function debounce(fn, wait=650){ let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), wait); }; }

    function computeOpenState(details){
      const bs = details?.business_status;
      if (bs === 'CLOSED_PERMAN_
